<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>音频频谱可视化</title><style>body{background-color:#111;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;margin:0;font-family:sans-serif;color:#fff}canvas{border:1px solid #333;background-color:#000;margin-bottom:20px}.control-panel{display:flex;flex-direction:column;gap:15px;margin-bottom:20px;width:500px}.tab-buttons{display:flex;gap:10px}button{padding:10px 20px;font-size:16px;cursor:pointer;background-color:#4caf50;color:#fff;border:none;border-radius:5px;flex:1}button:disabled{background-color:#666;cursor:not-allowed}.tab-content{display:none}.tab-content.active{display:block}#remoteAudio{width:100%}#localFileInfo{margin-top:10px;font-size:14px}#recordingStatus{margin-top:10px;font-size:14px}.localTab-wrap{display:flex;flex-direction:column;align-items:center;gap:15px}.file-upload-wrapper{position:relative;width:100%;margin-bottom:10px}.file-upload-label{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:120px;border:2px dashed #4caf50;border-radius:8px;background-color:rgba(76,175,80,.1);cursor:pointer;transition:all .3s ease}.file-upload-label:hover{background-color:rgba(76,175,80,.2);border-color:#3e8e41}.file-upload-label i{font-size:32px;color:#4caf50;margin-bottom:10px}.file-upload-label span{color:#4caf50;font-size:16px}.file-upload-label small{color:#888;font-size:12px;margin-top:5px}#localFileInput{position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer}#localFileInfo{width:100%;padding:10px;background-color:rgba(255,255,255,.05);border-radius:4px;text-align:center;font-size:14px;color:#ddd;min-height:20px;word-break:break-all}#localStartBtn{width:100%;background:linear-gradient(to right,#4caf50,#2e8b57);border:none;padding:12px;font-size:16px;border-radius:6px;transition:all .3s ease;box-shadow:0 2px 5px rgba(0,0,0,.2)}#localStartBtn:hover{background:linear-gradient(to right,#3e8e41,#2e7d32);transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.3)}#localStartBtn:active{transform:translateY(0)}@font-face{font-family:'Material Icons';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/materialicons/v140/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2')}.material-icons{font-family:'Material Icons';font-weight:400;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:'liga';-webkit-font-smoothing:antialiased}</style></head><body><canvas id="audioCanvas" width="800" height="400"></canvas><div class="control-panel"><div class="tab-buttons"><button id="remoteTabBtn">远程音频</button> <button id="localTabBtn">本地文件</button> <button id="recordTabBtn">实时录音</button></div><div id="remoteTab" class="tab-content active"><audio id="remoteAudio" controls src="https://m10.music.126.net/20250617120948/9c2f13e64471b46f79cf787810bc30af/ymusic/de29/62a8/a1eb/b70f566e9da385f115602d4d74e5dd6c.mp3" crossorigin="anonymous"></audio><button id="remoteStartBtn">开始分析</button></div><div id="localTab" class="tab-content active"><div class="localTab-wrap"><div class="file-upload-wrapper"><label for="localFileInput" class="file-upload-label"><i class="material-icons">cloud_upload</i> <span>点击或拖拽音频文件到此处</span> <small>支持MP3、WAV、OGG等格式</small></label> <input type="file" id="localFileInput" accept="audio/*"></div><div id="localFileInfo">未选择文件</div><button id="localStartBtn" disabled>开始分析</button></div></div><div id="recordTab" class="tab-content"><button id="recordStartBtn">开始录音</button> <button id="recordStopBtn" disabled>停止录音</button><div id="recordingStatus">准备录音</div></div></div><script>const canvas=document.getElementById("audioCanvas"),canvasCtx=canvas.getContext("2d"),remoteTabBtn=document.getElementById("remoteTabBtn"),localTabBtn=document.getElementById("localTabBtn"),recordTabBtn=document.getElementById("recordTabBtn"),remoteTab=document.getElementById("remoteTab"),localTab=document.getElementById("localTab"),recordTab=document.getElementById("recordTab"),remoteAudio=document.getElementById("remoteAudio"),remoteStartBtn=document.getElementById("remoteStartBtn"),localFileInput=document.getElementById("localFileInput"),localFileInfo=document.getElementById("localFileInfo"),localStartBtn=document.getElementById("localStartBtn"),fileUploadLabel=document.querySelector(".file-upload-label"),recordStartBtn=document.getElementById("recordStartBtn"),recordStopBtn=document.getElementById("recordStopBtn"),recordingStatus=document.getElementById("recordingStatus");let audioContext,analyser,source,frequencyData,animationId,mediaStream,mediaRecorder,audioChunks=[];function switchTab(e){remoteTab.classList.remove("active"),localTab.classList.remove("active"),recordTab.classList.remove("active"),"remote"===e?remoteTab.classList.add("active"):"local"===e?localTab.classList.add("active"):"record"===e&&recordTab.classList.add("active"),stopAnalysis()}function stopAnalysis(){animationId&&(cancelAnimationFrame(animationId),animationId=null),source&&(source.mediaElement&&source.mediaElement.pause(),source.stop&&source.stop(),source.disconnect(),source=null),mediaStream&&(mediaStream.getTracks().forEach((e=>e.stop())),mediaStream=null),canvasCtx.fillStyle="rgb(0, 0, 0)",canvasCtx.fillRect(0,0,canvas.width,canvas.height)}function initAudioAnalysis(){audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext),analyser=audioContext.createAnalyser(),analyser.fftSize=512,frequencyData=new Uint8Array(analyser.frequencyBinCount))}function draw(){animationId=requestAnimationFrame(draw),analyser.getByteFrequencyData(frequencyData),canvasCtx.fillStyle="rgb(0, 0, 0)",canvasCtx.fillRect(0,0,canvas.width,canvas.height);const e=canvas.width/frequencyData.length*1.5;let t,a=0;for(let n=0;n<frequencyData.length;n++)t=1.5*frequencyData[n],canvasCtx.fillStyle=`rgb(50, ${t+100}, 50)`,canvasCtx.fillRect(a,canvas.height-t,e,t),a+=e+1}function updateFileInfo(){const e=localFileInput.files[0];e?(localFileInfo.textContent=`已选择: ${e.name} (${formatFileSize(e.size)})`,localStartBtn.disabled=!1,fileUploadLabel.innerHTML=`\n        <i class="material-icons">check_circle</i>\n        <span>${e.name}</span>\n        <small>${formatFileSize(e.size)}</small>\n      `):(localFileInfo.textContent="未选择文件",localStartBtn.disabled=!0,fileUploadLabel.innerHTML='\n        <i class="material-icons">cloud_upload</i>\n        <span>点击或拖拽音频文件到此处</span>\n        <small>支持MP3、WAV、OGG等格式</small>\n      ')}function formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}remoteStartBtn.addEventListener("click",(()=>{stopAnalysis(),initAudioAnalysis(),source=audioContext.createMediaElementSource(remoteAudio),source.connect(analyser),analyser.connect(audioContext.destination),remoteAudio.play(),draw()})),localStartBtn.addEventListener("click",(()=>{const e=localFileInput.files[0];if(!e)return;stopAnalysis(),initAudioAnalysis();const t=new FileReader;t.onload=e=>{audioContext.decodeAudioData(e.target.result).then((e=>{source=audioContext.createBufferSource(),source.buffer=e,source.connect(analyser),analyser.connect(audioContext.destination),source.start(0),draw()})).catch((e=>{console.error("Error decoding audio data",e),localFileInfo.textContent="音频解码失败"}))},t.onerror=()=>{localFileInfo.textContent="文件读取失败"},t.readAsArrayBuffer(e)})),fileUploadLabel.addEventListener("dragover",(e=>{e.preventDefault(),fileUploadLabel.style.backgroundColor="rgba(76, 175, 80, 0.3)",fileUploadLabel.style.borderColor="#3e8e41"})),fileUploadLabel.addEventListener("dragleave",(()=>{fileUploadLabel.style.backgroundColor="rgba(76, 175, 80, 0.1)",fileUploadLabel.style.borderColor="#4CAF50"})),fileUploadLabel.addEventListener("drop",(e=>{e.preventDefault(),fileUploadLabel.style.backgroundColor="rgba(76, 175, 80, 0.1)",fileUploadLabel.style.borderColor="#4CAF50",e.dataTransfer.files.length&&(localFileInput.files=e.dataTransfer.files,updateFileInfo())})),localFileInput.addEventListener("change",updateFileInfo),recordStartBtn.addEventListener("click",(async()=>{try{stopAnalysis(),initAudioAnalysis(),mediaStream=await navigator.mediaDevices.getUserMedia({audio:!0}),recordingStatus.textContent="录音中...",recordStartBtn.disabled=!0,recordStopBtn.disabled=!1,source=audioContext.createMediaStreamSource(mediaStream),source.connect(analyser),analyser.connect(audioContext.destination),draw()}catch(e){console.error("Error accessing microphone",e),recordingStatus.textContent="无法访问麦克风"}})),recordStopBtn.addEventListener("click",(()=>{stopAnalysis(),recordingStatus.textContent="录音已停止",recordStartBtn.disabled=!1,recordStopBtn.disabled=!0})),remoteTabBtn.addEventListener("click",(()=>switchTab("remote"))),localTabBtn.addEventListener("click",(()=>switchTab("local"))),recordTabBtn.addEventListener("click",(()=>switchTab("record"))),switchTab("remote")</script></body></html>